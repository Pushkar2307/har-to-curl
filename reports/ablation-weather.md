# Ablation Study: Token Efficiency vs Explainability

**Date:** 2026-02-13
**HAR file:** `examples/weather/www.sfgate.com.har` (117 total entries, 12 after filtering)
**Query:** "Return the API that fetches the weather of San Francisco."

## Processing Pipeline

Shows how each stage reduces the number of entries before the LLM sees them.

| Stage | Entries | Removed | Cumulative Reduction |
|---|---|---|---|
| **Raw HAR entries** | 117 | — | — |
| Remove HTML responses | 110 | -7 | -6.0% |
| Remove static assets (MIME type) | 26 | -84 | -77.8% |
| Remove static assets (URL pattern) | 15 | -11 | -87.2% |
| Remove tracking/analytics | 14 | -1 | -88.0% |
| Remove OPTIONS preflight | 12 | -2 | -89.7% |
| **Deduplicate** (same endpoint pattern) | **12** | 0 | -89.7% |

> **Summary:** 117 raw entries → 12 after filtering (89.7% removed) → 12 unique patterns after dedup (89.7% total reduction)

> **Note — Body stripping:** After filtering, response bodies are dropped entirely and request bodies are truncated to 10 KB. This does not reduce entry count but significantly lowers memory usage for large HAR files (e.g. 87 MB → lightweight metadata only). The LLM never sees response bodies — only method, URL, status, MIME type, and size.

## LLM Feature Flag Ablation

*Latency = LLM API call time only (excludes parsing, filtering, dedup)*

| Configuration | Dedup | Candidates | Reasoning | Entries | Prompt Tok | Compl Tok | Total Tok | % vs Baseline | Latency | Match |
|---|---|---|---|---|---|---|---|---|---|---|
| Baseline (minimal) | ✗ | ✗ | ✗ | 12 | 1,421 | 67 | 1,488 | — | 1752ms | [11] |
| + Deduplication only | ✓ | ✗ | ✗ | 12 | 805 | 45 | 850 | -42.9% | 1509ms | [11] |
| + Candidates only | ✗ | ✓ | ✗ | 12 | 1,521 | 186 | 1,707 | +14.7% | 3990ms | [11] |
| + Reasoning only | ✗ | ✗ | ✓ | 12 | 1,448 | 114 | 1,562 | +5.0% | 2350ms | [11] |
| + Candidates + Reasoning | ✗ | ✓ | ✓ | 12 | 1,548 | 192 | 1,740 | +16.9% | 3617ms | [11] |
| Dedup + Candidates (default) | ✓ | ✓ | ✗ | 12 | 905 | 193 | 1,098 | -26.2% | 3462ms | [11] |
| All features (with reasoning) | ✓ | ✓ | ✓ | 12 | 932 | 192 | 1,124 | -24.5% | 3810ms | [11] |

## Isolated Feature Costs

| Feature | Prompt Δ | Completion Δ | Total Δ | What you get |
|---|---|---|---|---|
| Deduplication | -616 | -22 | -638 | URL compaction, fewer entries sent |
| Candidates + Confidence | +100 | +119 | +219 | Ranked alternatives with confidence bars |
| Reasoning text | +27 | +47 | +74 | Verbose thought process explanation |

## Shipping Default vs All Features

**Dedup + Candidates (shipping default):** 1,098 tokens (26.2% vs baseline)
- Confidence bars + candidate list provide the high-value UX
- Reasoning text omitted — adds ~47 completion tokens for limited end-user value

**All features (with reasoning):** 1,124 tokens
- Full transparency including verbose reasoning text (24.5% vs baseline)
- Available via `reasoning: true` flag for debugging or detailed analysis

## Correctness

**All configurations returned the same match** ✓ — feature flags do not affect accuracy.

## Matched Entry Details

**Baseline (minimal):** [11] https://forecast7.com/en/37d77n122d42/san-francisco/?format=json
> This request to 'https://forecast7.com/en/37d77n122d42/san-francisco/?format=json' specifically fetches weather data for San Francisco, returning it in JSON format, making it the best match for the user's request.

**+ Deduplication only:** [11] https://forecast7.com/en/37d77n122d42/san-francisco/?format=json
> This request fetches weather data specifically for San Francisco, as indicated by the URL containing 'san-francisco' and the endpoint returning JSON data.

**+ Candidates only:** [11] https://forecast7.com/en/37d77n122d42/san-francisco/?format=json
> The best match is the endpoint that directly fetches weather data for San Francisco in JSON format, making it highly relevant to the user's request.

**+ Reasoning only:** [11] https://forecast7.com/en/37d77n122d42/san-francisco/?format=json
> This request directly fetches weather data for San Francisco, which aligns perfectly with the user's request for an API that provides weather information for that location.

**+ Candidates + Reasoning:** [11] https://forecast7.com/en/37d77n122d42/san-francisco/?format=json
> This is the best match because it directly fetches weather data for San Francisco in JSON format, aligning perfectly with the user's request.

**Dedup + Candidates (default):** [11] https://forecast7.com/en/37d77n122d42/san-francisco/?format=json
> The best match is the endpoint that directly references 'san-francisco' and returns weather data in JSON format, making it highly likely to fulfill the user's request for weather information.

**All features (with reasoning):** [11] https://forecast7.com/en/37d77n122d42/san-francisco/?format=json
> This is the best match because it directly references San Francisco in the URL and returns weather data in JSON format.

---
*Generated by ablation.ts*
